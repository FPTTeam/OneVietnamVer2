
@using Microsoft.AspNet.Identity
@model OneVietnam.Models.TimelineViewModel
@{
    ViewBag.Title = "Timeline";
}
<script>
    @*var x =  @Model.Profile.Location.XCoordinate;
    var y = @Model.Profile.Location.YCoordinate;
    var address = '@Model.Profile.Location.Address';
    var icon;
    var userLocationMarker;
    var map;*@
</script>
<script src="~/Scripts/jquery-1.10.2.js"></script>
<script src="~/Scripts/timeline.js"></script>

@if (Model != null) //TODO them dieu kien user chua bi lock
{
    <div class="containers">
       
        <a href="#"><img src="@Model.AvatarLink" alt="cover" class="cover"/></a>
        @if (Model.Id.Equals(User.Identity.GetUserId()))
        {
            <i class="large inverted grey camera icon edit-avatar"></i>
            <div id="avatarUpload" class="hides">
                <form id="uploader">
                    <input type="file" id="fileInput" name="fileInput" onchange="submitImage()" />
                    <input type="submit" id="btnUpload" name="btnUpload" />
                </form>
            </div>
            <script>
                $(".camera.icon")
                    .click(function() {
                        $("#fileInput").trigger('click');
                    });
                function submitImage() {
                    $("#btnUpload").trigger('click');                    
                }
                window.onload = function () {
                    document.getElementById('uploader').onsubmit = function () {
                        var formdata = new FormData();
                        var fileInput = document.getElementById('fileInput');
                        for (var i = 0; i < fileInput.files.length; i++) {
                            formdata.append(fileInput.files[i].name, fileInput.files[i]);
                        }
                        var xhr = new XMLHttpRequest();
                        xhr.open('POST', '/Timeline/ChangeAvatar');
                        xhr.send(formdata);
                        xhr.onreadystatechange = function () {
                            if (xhr.readyState === 4 && xhr.status === 200) {                               
                            }
                        }
                        return false;
                    }
                }

            </script>

        }
        <div class="hero">

            <div class="details">

                <div class="title1" id="lblTimeLineUserName">@if (Model.UserName != null)
                                                             {@Model.UserName
                                                             }</div>

                <div class="title2">The Battle of the Five Armies</div>


            </div> <!-- end details -->

        </div> <!-- end hero -->

        <div class="ui grid">

            <div class="three wide column">

            </div> <!-- end column1 -->

            <div class="eleven wide column">


                <div class="ui pointing secondary tabular menu">
                    @{
                        var postCount = 0;
                        if (Model.PostList != null && Model.PostList.Count > 0)
                        {
                            postCount = Model.PostList.Count;
                        }
                    }
                    <div class="item active" data-tab="timeline">Bài đăng
                        <div class="ui teal   label">@postCount</div>
                    </div>
                    <div class="item" data-tab="profile" onclick="showUserMarkerOnMap(x,y,address);">Giới thiệu</div>
                    @if (Model.Id.Equals(User.Identity.GetUserId()))
                    {
                        <div class="item" data-tab="setting">Cài đặt</div>
                    }

                </div>
                <div class="ui tab active" data-tab="timeline">
                    @{
                        if (Model.PostList != null && Model.PostList.Count > 0)
                        {
                            <div class="grids">
                                <div class="grid-sizer"></div>
                                <div class="gutter-sizer"></div>
                                @{
                                    foreach (var postView in Model.PostList)
                                    {
                                        @Html.Partial("../Shared/_ShowPostDetail", postView)
                                    }
                                }
                            </div>
                        }
                    }
                </div>
                <div class="ui tab" data-tab="profile" >
                    <div id="EditProfileForm">
                        @Html.Partial("_EditProfile", Model.Profile)
                    </div>
                </div>


                @if (Model.Id.Equals(User.Identity.GetUserId()))
                {
                    <div class="ui tab" data-tab="setting">
                        <div class="ui segment">
                            <div class="ui middle aligned selection list">
                                @{
                                    string value = "Tắt";
                                    if (Model.Setting.TwoFacterEnabled == false)
                                    {
                                        value = "Bật";
                                    }
                                }
                                <div class="ui item" style="width: 100%; padding: 0">
                                    <div class="ui horizontal list" style="width: 100%; padding: 0">
                                        <div class="ui item">
                                            <div class="ui medium header">
                                                <i class="protect icon"></i>
                                                <div class="content">
                                                    Bảo mật hai lớp
                                                    <div class="sub header">Bật bảo mât hai lớp để nâng cao bảo mật</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ui right floated item">
                                            <button class="ui toggle button" onclick="changeTwoFactorAuthentication()">@value</button>
                                        </div>
                                    </div>


                                </div>


                                <div class="ui item" style="width: 100%; padding: 0">
                                    <div class="ui horizontal list" style="width: 100%; padding: 0">
                                        <div class="ui item">
                                            <div class="ui medium header">
                                                <i class="privacy icon"></i>
                                                <div class="content">
                                                    Mật khẩu
                                                    @if (Model.Setting.HasPassWord)
                                                    {
                                                        <div class="sub header" id="ShowPassword">Thay đổi mật khẩu thường xuyên để nâng cao bảo mật hơn</div>
                                                    }
                                                    else
                                                    {
                                                        <div class="sub header" id="ShowPassword">Tạo mật khẩu mới đê đăng nhập bằng email</div>
                                                    }

                                                </div>
                                            </div>
                                        </div>
                                        <div class="ui right floated middle aligned item">
                                            @if (Model.Setting.HasPassWord)
                                            {
                                                <input type="button" class="ui right floated teal button" id="btnChangePass" value="Đổi mật khẩu" onclick="showChangePasswordForm()"/>
                                            }
                                            else
                                            {
                                                <input type="button" class="ui right floated teal button" id="btnChangePass" value="Thêm mật khẩu" onclick="showSetPasswordForm()"/>
                                            }

                                        </div>
                                    </div>
                                    <div id="ChangePasswordForm"></div>
                                </div>



                            </div>
                        </div>
                    </div>
                }


                <!-- end avatars -->



            </div> <!-- end column2 -->
        </div> <!-- end description -->


    </div> <!-- end container -->
                            }
                            else
                            {
                                <div style="margin: auto; width: 40%">
                                    <div class="ui segment">
                                        <div class="ui centered header">
                                            <i class="warning circle icon"></i>
                                            Trang bạn tìm kiếm đã bị xóa hoặc không tồn tại
                                        </div>
                                    </div>
                                </div>

                            }
